<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.4 RStudio calculations | Technical Guide for Estimating Building Rooftop Solar Potential in a City</title>
  <meta name="description" content="A technical guide for mapping rooftop solar potential in a city using open source data and software." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4.4 RStudio calculations | Technical Guide for Estimating Building Rooftop Solar Potential in a City" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bookdown.org/einavg7/sp_technical_guide/" />
  
  <meta property="og:description" content="A technical guide for mapping rooftop solar potential in a city using open source data and software." />
  <meta name="github-repo" content="Einavg7/Solar-Potential-Technical-Guide" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.4 RStudio calculations | Technical Guide for Estimating Building Rooftop Solar Potential in a City" />
  
  <meta name="twitter:description" content="A technical guide for mapping rooftop solar potential in a city using open source data and software." />
  

<meta name="author" content="Einav Grinberg" />


<meta name="date" content="2022-03-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="spatial-stratified-sampling-with-qgis.html"/>
<link rel="next" href="comparison-between-sample-results-and-sampling-methods.html"/>
<script src="libs/header-attrs-2.13/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.0/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.0/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Technical Guide</a></li>

<li class="divider"></li>
<li><a href="index.html#introduction">Introduction<span></span></a>
<ul>
<li><a href="motivation-behind-the-guide.html#motivation-behind-the-guide">Motivation behind the guide<span></span></a></li>
<li><a href="structure-of-the-guide.html#structure-of-the-guide">Structure of the guide<span></span></a></li>
<li><a href="guide-outputs.html#guide-outputs">Guide outputs<span></span></a></li>
<li><a href="acknowledgments.html#acknowledgments">Acknowledgments<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="open-source-software-and-data.html"><a href="open-source-software-and-data.html"><i class="fa fa-check"></i><b>1</b> Open source software and data<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="qgis.html"><a href="qgis.html"><i class="fa fa-check"></i><b>1.1</b> QGIS<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="quickmapservices-qms.html"><a href="quickmapservices-qms.html"><i class="fa fa-check"></i><b>1.2</b> QuickMapServices (QMS)<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>1.3</b> RStudio<span></span></a></li>
<li class="chapter" data-level="1.4" data-path="open-street-map-osm.html"><a href="open-street-map-osm.html"><i class="fa fa-check"></i><b>1.4</b> Open Street Map (OSM)<span></span></a></li>
<li class="chapter" data-level="1.5" data-path="global-solar-atlas.html"><a href="global-solar-atlas.html"><i class="fa fa-check"></i><b>1.5</b> Global Solar Atlas<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mapping-electricity-consumption.html"><a href="mapping-electricity-consumption.html"><i class="fa fa-check"></i><b>2</b> Mapping electricity consumption<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="adding-table-data-to-qgis.html"><a href="adding-table-data-to-qgis.html"><i class="fa fa-check"></i><b>2.1</b> Adding table data to QGIS<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="adding-vector-layers-to-qgis.html"><a href="adding-vector-layers-to-qgis.html"><i class="fa fa-check"></i><b>2.2</b> Adding vector layers to QGIS<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="joining-vector-layers-and-table-data.html"><a href="joining-vector-layers-and-table-data.html"><i class="fa fa-check"></i><b>2.3</b> Joining vector layers and table data<span></span></a></li>
<li class="chapter" data-level="2.4" data-path="consumption-visualizations.html"><a href="consumption-visualizations.html"><i class="fa fa-check"></i><b>2.4</b> Consumption visualizations<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="solar-radiation-and-renewable-electricity-calculation.html"><a href="solar-radiation-and-renewable-electricity-calculation.html"><i class="fa fa-check"></i><b>3</b> Solar radiation and renewable electricity calculation<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="adding-raster-layers-to-qgis.html"><a href="adding-raster-layers-to-qgis.html"><i class="fa fa-check"></i><b>3.1</b> Adding raster layers to QGIS<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="extracting-raster-values-to-vector-layers.html"><a href="extracting-raster-values-to-vector-layers.html"><i class="fa fa-check"></i><b>3.2</b> Extracting raster values to vector layers<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="qgis-field-calculator.html"><a href="qgis-field-calculator.html"><i class="fa fa-check"></i><b>3.3</b> QGIS Field calculator<span></span></a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="qgis-field-calculator.html"><a href="qgis-field-calculator.html#building-rooftop-area"><i class="fa fa-check"></i><b>3.3.1</b> Building rooftop area<span></span></a></li>
<li class="chapter" data-level="3.3.2" data-path="qgis-field-calculator.html"><a href="qgis-field-calculator.html#usable-solar-radiation"><i class="fa fa-check"></i><b>3.3.2</b> Usable solar radiation<span></span></a></li>
<li class="chapter" data-level="3.3.3" data-path="qgis-field-calculator.html"><a href="qgis-field-calculator.html#renewable-electricity-production"><i class="fa fa-check"></i><b>3.3.3</b> Renewable electricity production<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="renewable-electricity-estimation-for-the-whole-city.html"><a href="renewable-electricity-estimation-for-the-whole-city.html"><i class="fa fa-check"></i><b>4</b> Renewable electricity estimation for the whole city<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="what-is-sampling-and-spatial-sampling.html"><a href="what-is-sampling-and-spatial-sampling.html"><i class="fa fa-check"></i><b>4.1</b> What is sampling and spatial sampling?<span></span></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="what-is-sampling-and-spatial-sampling.html"><a href="what-is-sampling-and-spatial-sampling.html#selecting-a-sample-size"><i class="fa fa-check"></i><b>4.1.1</b> Selecting a sample size<span></span></a></li>
<li class="chapter" data-level="4.1.2" data-path="what-is-sampling-and-spatial-sampling.html"><a href="what-is-sampling-and-spatial-sampling.html#la-plata-sample-size-calculation"><i class="fa fa-check"></i><b>4.1.2</b> La Plata sample size calculation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="spatial-random-sampling-with-qgis.html"><a href="spatial-random-sampling-with-qgis.html"><i class="fa fa-check"></i><b>4.2</b> Spatial random sampling with QGIS<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="spatial-random-sampling-with-qgis.html"><a href="spatial-random-sampling-with-qgis.html#the-qms-plugin"><i class="fa fa-check"></i><b>4.2.1</b> The QMS plugin<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="spatial-random-sampling-with-qgis.html"><a href="spatial-random-sampling-with-qgis.html#digitizing-a-sample-with-qms"><i class="fa fa-check"></i><b>4.2.2</b> Digitizing a sample with QMS<span></span></a></li>
<li class="chapter" data-level="4.2.3" data-path="spatial-random-sampling-with-qgis.html"><a href="spatial-random-sampling-with-qgis.html#including-the-density-factor"><i class="fa fa-check"></i><b>4.2.3</b> Including the density factor<span></span></a></li>
<li class="chapter" data-level="4.2.4" data-path="spatial-random-sampling-with-qgis.html"><a href="spatial-random-sampling-with-qgis.html#solar-radiation-and-renewable-electricity-calculation-1"><i class="fa fa-check"></i><b>4.2.4</b> Solar radiation and renewable electricity calculation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="spatial-stratified-sampling-with-qgis.html"><a href="spatial-stratified-sampling-with-qgis.html"><i class="fa fa-check"></i><b>4.3</b> Spatial stratified sampling with QGIS<span></span></a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="spatial-stratified-sampling-with-qgis.html"><a href="spatial-stratified-sampling-with-qgis.html#land-use-change-raster"><i class="fa fa-check"></i><b>4.3.1</b> Land use change raster<span></span></a></li>
<li class="chapter" data-level="4.3.2" data-path="spatial-stratified-sampling-with-qgis.html"><a href="spatial-stratified-sampling-with-qgis.html#raster-to-polygons"><i class="fa fa-check"></i><b>4.3.2</b> Raster to polygons<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="rstudio-calculations.html"><a href="rstudio-calculations.html"><i class="fa fa-check"></i><b>4.4</b> RStudio calculations<span></span></a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="rstudio-calculations.html"><a href="rstudio-calculations.html#random-sampling"><i class="fa fa-check"></i><b>4.4.1</b> Random sampling<span></span></a></li>
<li class="chapter" data-level="4.4.2" data-path="rstudio-calculations.html"><a href="rstudio-calculations.html#equal-size-stratification"><i class="fa fa-check"></i><b>4.4.2</b> Equal size stratification<span></span></a></li>
<li class="chapter" data-level="4.4.3" data-path="rstudio-calculations.html"><a href="rstudio-calculations.html#optimal-allocation-stratification"><i class="fa fa-check"></i><b>4.4.3</b> Optimal allocation stratification<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="comparison-between-sample-results-and-sampling-methods.html"><a href="comparison-between-sample-results-and-sampling-methods.html"><i class="fa fa-check"></i><b>4.5</b> Comparison between sample results and sampling methods<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="results-and-outputs.html"><a href="results-and-outputs.html"><i class="fa fa-check"></i><b>5</b> Results and outputs<span></span></a></li>
<li class="chapter" data-level="6" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>6</b> References<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Technical Guide for Estimating Building Rooftop Solar Potential in a City</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rstudio-calculations" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> RStudio calculations<a href="rstudio-calculations.html#rstudio-calculations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To calculate the estimation of the total renewable electricity potential in La Plata we will use RStudio. If you have no prior experience with R or RStudio it is recommended to follow this <a href="https://moderndive.com/1-getting-started.html">Getting Started with Data in R tutorial</a>.</p>
<p>The methodology, calculations and equations in this section are based on the book <strong>Sampling by Steven K. Thompson</strong> published in 2012. (See <a href="references.html#references">6</a>)</p>
<p><strong>The full calculations for this section can be found <a href="https://bookdown.org/einavg7/laplata_sampling/laplata_sampling.html">here</a></strong></p>
<p>First, we will open a new R Script, install the required packages for this analysis and set our work directory:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="rstudio-calculations.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install packages</span></span>
<span id="cb1-2"><a href="rstudio-calculations.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb1-3"><a href="rstudio-calculations.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;sf&quot;</span>)</span>
<span id="cb1-4"><a href="rstudio-calculations.html#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="rstudio-calculations.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#load pacakges</span></span>
<span id="cb1-6"><a href="rstudio-calculations.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="rstudio-calculations.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-8"><a href="rstudio-calculations.html#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="rstudio-calculations.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#set work directory</span></span>
<span id="cb1-10"><a href="rstudio-calculations.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;.../La Plata/data&quot;</span>)</span></code></pre></div>
<div id="random-sampling" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Random sampling<a href="rstudio-calculations.html#random-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To start with our random sampling computations we will read the sample100.shp from our directory to RStudio with the <code>read_sf</code> function and set its CRS with the <code>st_transform</code> function. Both functions are from the <a href="https://r-spatial.github.io/sf/"><strong>Simple Features for R (sf)</strong> library</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="rstudio-calculations.html#cb2-1" aria-hidden="true" tabindex="-1"></a>sample1 <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;data/sample100.shp&quot;</span>)</span>
<span id="cb2-2"><a href="rstudio-calculations.html#cb2-2" aria-hidden="true" tabindex="-1"></a>sample1 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(sample1, <span class="st">&quot;+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs&quot;</span>)</span></code></pre></div>
<p>Next, we will assign all the building rooftops with an area of 30 and under, the value 0 to include our density factor. In addition, we will create a column with megawatt per hour (mWh) so the results will be easier to read.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="rstudio-calculations.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#change to 0 above and equal 30 sqm</span></span>
<span id="cb3-2"><a href="rstudio-calculations.html#cb3-2" aria-hidden="true" tabindex="-1"></a>sample1<span class="sc">$</span>elec_prod[sample1<span class="sc">$</span>area <span class="sc">&lt;=</span> <span class="dv">30</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-3"><a href="rstudio-calculations.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#create mega watt per hour (mWh) column</span></span>
<span id="cb3-4"><a href="rstudio-calculations.html#cb3-4" aria-hidden="true" tabindex="-1"></a>sample1<span class="sc">$</span>elec_prod_mwh <span class="ot">&lt;-</span> sample1<span class="sc">$</span>elec_prod<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb3-5"><a href="rstudio-calculations.html#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="rstudio-calculations.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sample1)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 6 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -6480273 ymin: -4138361 xmax: -6455331 ymax: -4118445
## CRS:           +proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs
## # A tibble: 6 x 7
##      id    area X_mean usable_sr elec_prod                              geometry
##   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;                         &lt;POLYGON [m]&gt;
## 1     3  91.0    1728.   157246.    20285. ((-6461504 -4132034, -6461500 -41320~
## 2     4 131.     1735.   227935.    29404. ((-6466451 -4118457, -6466438 -41184~
## 3     8  59.1    1736.   102639.    13240. ((-6465099 -4118684, -6465094 -41186~
## 4     1   0.189  1729.      327.        0  ((-6455332 -4132428, -6455331 -41324~
## 5     2   0.063  1725.      109.        0  ((-6480273 -4138360, -6480272 -41383~
## 6     5   0.077  1726.      133.        0  ((-6468889 -4135469, -6468889 -41354~
## # ... with 1 more variable: elec_prod_mwh &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="rstudio-calculations.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sample1)</span></code></pre></div>
<pre><code>##        id              area               X_mean       usable_sr       
##  Min.   :  1.00   Min.   :    0.002   Min.   :1721   Min.   :       3  
##  1st Qu.: 25.75   1st Qu.:    0.021   1st Qu.:1724   1st Qu.:      36  
##  Median : 50.50   Median :    0.078   Median :1727   Median :     134  
##  Mean   : 50.50   Mean   :  243.218   Mean   :1727   Mean   :  419697  
##  3rd Qu.: 75.25   3rd Qu.:    0.240   3rd Qu.:1729   3rd Qu.:     413  
##  Max.   :100.00   Max.   :10405.603   Max.   :1740   Max.   :17939051  
##    elec_prod                geometry   elec_prod_mwh    
##  Min.   :      0   POLYGON      :100   Min.   :   0.00  
##  1st Qu.:      0   epsg:NA      :  0   1st Qu.:   0.00  
##  Median :      0   +proj=merc...:  0   Median :   0.00  
##  Mean   :  54056                       Mean   :  54.06  
##  3rd Qu.:      0                       3rd Qu.:   0.00  
##  Max.   :2314138                       Max.   :2314.14</code></pre>
<p>To start with the estimation we will need to compute the primary parameters of the sample.
The following steps show what functions or equations are used to calculate the parameters in RStudio. Most of the functions used are from base R and their descriptions can be found <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/00Index.html">here</a>.</p>
<p>First, we calculate the sample mean <span class="math inline">\(\overline{y}\)</span> and the sample variance <span class="math inline">\(s\)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="rstudio-calculations.html#cb7-1" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">nrow</span>(sample1))</span>
<span id="cb7-2"><a href="rstudio-calculations.html#cb7-2" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(sample1<span class="sc">$</span>elec_prod_mwh)</span>
<span id="cb7-3"><a href="rstudio-calculations.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The mean of sample 1: &quot;</span>, <span class="fu">round</span>(y1,<span class="dv">2</span>), <span class="st">&quot;(mWh)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The mean of sample 1:  54.06 (mWh)&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="rstudio-calculations.html#cb9-1" aria-hidden="true" tabindex="-1"></a>N_all <span class="ot">&lt;-</span> <span class="dv">2482</span> <span class="co">#all buildings in the city</span></span>
<span id="cb9-2"><a href="rstudio-calculations.html#cb9-2" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">var</span>(sample1<span class="sc">$</span>elec_prod_mwh)</span>
<span id="cb9-3"><a href="rstudio-calculations.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The variance of sample 1: &quot;</span>, <span class="fu">round</span>(s1,<span class="dv">2</span>), <span class="st">&quot;(mWh)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The variance of sample 1:  78930.14 (mWh)&quot;</code></pre>
<p>The following equation calculates the unbiased variance of the estimator <span class="math inline">\(\overline{y}\)</span>:</p>
<p><span class="math display" id="eq:unvar">\[\begin{equation} 
  \hat{var}(\overline{y})= (\frac{N-n}{N})(\frac{s^2}{n}) \tag{4.3}
\end{equation}\]</span></p>
<ul>
<li><span class="math inline">\(N\)</span> is the total population size -&gt; the number of all the buildings in La Plata (2,482).<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a></li>
<li><span class="math inline">\(n\)</span> is the sample size -&gt; 100.</li>
<li><span class="math inline">\(s^2\)</span> is the sample variance.</li>
</ul>
<p>The following equation calculates the estimated standard error of the estimator <span class="math inline">\(\overline{y}\)</span> (SEM):</p>
<p><span class="math display" id="eq:se">\[\begin{equation} 
  SEM = \sqrt{\hat{var}(\overline{y})} \tag{4.4}
\end{equation}\]</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="rstudio-calculations.html#cb11-1" aria-hidden="true" tabindex="-1"></a>var_un1 <span class="ot">&lt;-</span> ((N_all<span class="sc">-</span>n1)<span class="sc">/</span>N_all)<span class="sc">*</span>(s1<span class="sc">/</span>n1)</span>
<span id="cb11-2"><a href="rstudio-calculations.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The variance of the sample mean: &quot;</span>, <span class="fu">round</span>(var_un1,<span class="dv">2</span>) , <span class="st">&quot;(mWh)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The variance of the sample mean:  757.5 (mWh)&quot;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="rstudio-calculations.html#cb13-1" aria-hidden="true" tabindex="-1"></a>ese1 <span class="ot">=</span> <span class="fu">sqrt</span>(var_un1) <span class="co">#estimated standard error of variance</span></span>
<span id="cb13-2"><a href="rstudio-calculations.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The estimated standard error of the sample mean: &quot;</span>, <span class="fu">round</span>(ese1,<span class="dv">2</span>), <span class="st">&quot;(mWh)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The estimated standard error of the sample mean:  27.52 (mWh)&quot;</code></pre>
<p>The following equation calculates an unbiased estimator of the population total <span class="math inline">\(\hat{t}\)</span>:
<span class="math display" id="eq:t">\[\begin{equation} 
  \hat{t} = N{\overline{y}} \tag{4.5}
\end{equation}\]</span></p>
<p>The following equation calculates the unbiased variance of the estimator <span class="math inline">\(\hat{t}\)</span>:</p>
<p><span class="math display" id="eq:tv">\[\begin{equation} 
  \hat{var}(\hat{t})= N^2\hat{var}(\overline{y}) \tag{4.6}
\end{equation}\]</span></p>
<p>The following equation calculates the estimated standard error of the estimator <span class="math inline">\(\hat{t}\)</span> (SET):
<span class="math display" id="eq:set">\[\begin{equation} 
  SET = \sqrt{\hat{var}(\hat{t})} \tag{4.7}
\end{equation}\]</span></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="rstudio-calculations.html#cb15-1" aria-hidden="true" tabindex="-1"></a>t_un1 <span class="ot">=</span> N_all<span class="sc">*</span>y1 </span>
<span id="cb15-2"><a href="rstudio-calculations.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The estimation of the renewable electricity production potential by all the buildings in the city:&quot;</span>, <span class="fu">round</span>(t_un1,<span class="dv">2</span>), <span class="st">&quot;(mWh)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The estimation of the renewable electricity production potential by all the buildings in the city: 134167.17 (mWh)&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="rstudio-calculations.html#cb17-1" aria-hidden="true" tabindex="-1"></a>t_var_un1 <span class="ot">=</span> (N_all<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> var_un1 <span class="co">#unbiased variance with the estimate of the total</span></span>
<span id="cb17-2"><a href="rstudio-calculations.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The variance of the estimated total:&quot;</span>, <span class="fu">round</span>(t_var_un1,<span class="dv">2</span>), <span class="st">&quot;(mWh)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The variance of the estimated total: 4666447948.84 (mWh)&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="rstudio-calculations.html#cb19-1" aria-hidden="true" tabindex="-1"></a>ese_t1 <span class="ot">=</span> <span class="fu">sqrt</span>(t_var_un1) <span class="co">#estimated standard error of total</span></span>
<span id="cb19-2"><a href="rstudio-calculations.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The estimated standard error of the total:&quot;</span>, <span class="fu">round</span>(ese_t1,<span class="dv">2</span>), <span class="st">&quot;(mWh)&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The estimated standard error of the total: 68311.4 (mWh)&quot;</code></pre>
<p>The following code calculates a 95% confidence interval for the sample.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="rstudio-calculations.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#confidence interval with 95% </span></span>
<span id="cb21-2"><a href="rstudio-calculations.html#cb21-2" aria-hidden="true" tabindex="-1"></a>CI1 <span class="ot">&lt;-</span> t_un1 <span class="sc">+</span> <span class="fu">qt</span>(<span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>), <span class="at">df=</span><span class="dv">99</span>) <span class="sc">*</span> ese_t1</span>
<span id="cb21-3"><a href="rstudio-calculations.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;The 95% confidence interval estimation for sample 1 is: &quot;</span>, <span class="st">&quot;(&quot;</span>,<span class="fu">round</span>(CI1[<span class="dv">1</span>],<span class="dv">2</span>),<span class="st">&quot; (mWh), &quot;</span>,<span class="fu">round</span>(CI1[<span class="dv">2</span>],<span class="dv">2</span>),<span class="st">&quot; (mwh))&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The 95% confidence interval estimation for sample 1 is: (20743.51 (mWh), 247590.82 (mwh))&quot;</code></pre>
<p>We repeat these calculations for the sample with 300 building rooftops and both samples combined.</p>
</div>
<div id="equal-size-stratification" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Equal size stratification<a href="rstudio-calculations.html#equal-size-stratification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the equal size strata, we have 60 building rooftops sampled for the built up area and non built up area. We combine the two strata to one <code>sf</code> object using the <code>rbind</code> function and compute the same calculations as in <a href="rstudio-calculations.html#random-sampling">4.4.1</a>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="rstudio-calculations.html#cb23-1" aria-hidden="true" tabindex="-1"></a>bu <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;strata_bu.shp&quot;</span>)</span>
<span id="cb23-2"><a href="rstudio-calculations.html#cb23-2" aria-hidden="true" tabindex="-1"></a>bu <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(bu, <span class="st">&quot;+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs&quot;</span>)</span>
<span id="cb23-3"><a href="rstudio-calculations.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#add a landuse column to differ between strata when combined</span></span>
<span id="cb23-4"><a href="rstudio-calculations.html#cb23-4" aria-hidden="true" tabindex="-1"></a>bu<span class="sc">$</span>landuse <span class="ot">&lt;-</span> <span class="st">&quot;Built up&quot;</span></span>
<span id="cb23-5"><a href="rstudio-calculations.html#cb23-5" aria-hidden="true" tabindex="-1"></a>nonbu <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;strata_nonbu.shp&quot;</span>)</span>
<span id="cb23-6"><a href="rstudio-calculations.html#cb23-6" aria-hidden="true" tabindex="-1"></a>nonbu <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(nonbu, <span class="st">&quot;+proj=merc +lon_0=0 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs&quot;</span>)</span>
<span id="cb23-7"><a href="rstudio-calculations.html#cb23-7" aria-hidden="true" tabindex="-1"></a>nonbu<span class="sc">$</span>landuse <span class="ot">&lt;-</span> <span class="st">&quot;Non built up&quot;</span></span>
<span id="cb23-8"><a href="rstudio-calculations.html#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="rstudio-calculations.html#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#combine strata and change to 0 above and equal 30 sqm</span></span>
<span id="cb23-10"><a href="rstudio-calculations.html#cb23-10" aria-hidden="true" tabindex="-1"></a>strat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(bu, nonbu)</span>
<span id="cb23-11"><a href="rstudio-calculations.html#cb23-11" aria-hidden="true" tabindex="-1"></a>strat<span class="sc">$</span>elec_prod[strat<span class="sc">$</span>area <span class="sc">&lt;=</span> <span class="dv">30</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-12"><a href="rstudio-calculations.html#cb23-12" aria-hidden="true" tabindex="-1"></a>strat<span class="sc">$</span>elec_prod_mwh <span class="ot">&lt;-</span> strat<span class="sc">$</span>elec_prod<span class="sc">/</span><span class="dv">1000</span></span></code></pre></div>
</div>
<div id="optimal-allocation-stratification" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Optimal allocation stratification<a href="rstudio-calculations.html#optimal-allocation-stratification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The sample calculations from the built up area present more variable strata. To achieve a better estimation we would like to divide the city into strata using an optimal allocation design. The optimum scheme allocates a larger sample size to the more variable strata and a smaller sample size to the more difficult-to-sample strata.</p>
<p>Therefore, we will follow section <a href="spatial-random-sampling-with-qgis.html#spatial-random-sampling-with-qgis">4.2</a> and compute more spatial random points in the built up strata and less in the non built up strata.</p>
<p>After, we will add again the optimally allocated strata to RStudio and calculate the parameters for this sample, as described in <a href="rstudio-calculations.html#random-sampling">4.4.1</a> and <a href="rstudio-calculations.html#equal-size-stratification">4.4.2</a>.</p>
<p>In this analysis for the built up strata 95 building rooftops were sampled, and for the non built up strata 5.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="19">
<li id="fn19"><p>DATA FROM 2019, CONTRIBUTED BY JULIETA FREDIANI FROM THE INSTITUTE OF RESEARCH AND POLICIES OF THE BUILT ENVIRONMENT - FACULTY OF ARCHITECTURE AND URBANISM - NATIONAL UNIVERSITY OF LA PLATA.<a href="rstudio-calculations.html#fnref19" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spatial-stratified-sampling-with-qgis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="comparison-between-sample-results-and-sampling-methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Einavg7/Solar_Potential_Technical_Guideindex.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
